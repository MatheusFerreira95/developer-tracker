<!DOCTYPE html>
<html style="height: 100%">

<head>
  <meta charset="utf-8">
</head>

<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>
  <script type="text/javascript" src="echarts-en.min.js"></script>
  <script type="text/javascript">
    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    var app = {};
    option = null;
    var nodes = [{
      name: 'Matheus Ferreira',
      img: 'developer.png',
      alarm: 'atenção'
    },
    {
      name: 'Heitor Costa',
      img: 'developer.png'
    },
    {
      name: 'Luana Martins',
      img: 'developer.png'
    },
    {
      name: 'index.js',
      img: 'file.png'
    },
    {
      name: 'style.css',
      img: 'file.png',
      alarm: 'alerta amarelo'
    },
    {
      name: 'pages',
      img: 'folder.png'
    }
    ]
    var links = [{
      source: 'Luana Martins',
      target: 'pages',
      name: '10 LOC / 1 commits'
    }, {
      source: 'Heitor Costa',
      target: 'pages',
      name: '20 LOC / 2 commits'
    },
    {
      source: 'Matheus Ferreira',
      target: 'index.js',
      name: '30 LOC / 3 commits'
    },
    {
      source: 'Heitor Costa',
      target: 'style.css',
      name: '40 LOC / 4 commits'
    },
    {
      source: 'Luana Martins',
      target: 'pages',
      name: '10 LOC / 2 commits'
    }
    ]
    var charts = {
      nodes: [],
      links: []
    }
    for (var j = 0; j < nodes.length; j++) {
      var node = {
        name: nodes[j].name,
        alarm: nodes[j].alarm,
        symbol: 'image://' + nodes[j].img,
        itemStyle: {
          normal: {
            color: '#12b5d0',
          }
        }
      }
      charts.nodes.push(node)
    }
    for (var i = 0; i < links.length; i++) {
      var link = {
        source: links[i].source,
        target: links[i].target,
        label: {
          normal: {
            show: true,
            formatter: links[i].name
          }
        },
        lineStyle: {
          normal: {
            color: '#000'
          }
        }
      }
      charts.links.push(link)
    }
    option = {
      backgroundColor: '#fff',
      title: {
        text: 'titulo do gráfico',
        textStyle: {
          fontWeight: 'normal',
          color: "red",
        }
      },
      tooltip: {
        formatter: function (x) {
          return x.data.des;
        }
      },
      series: [{
        type: 'graph',
        layout: 'force',
        symbolSize: 50,
        edgeSymbol: ['circle', 'arrow'],
        force: {
          repulsion: 1000,
          edgeLength: [150, 200],
          layoutAnimation: false
        },
        draggable: false,
        edgeLabel: {
          normal: {
            show: true,
            formatter: function (x) {
              return x.data.name;
            }
          }
        },
        label: {
          normal: {
            show: true,
            position: 'bottom',
            color: '#000'
          }
        },
        lineStyle: {
          normal: {
            width: 2,
            shadowColor: 'none'
          }
        },
        data: charts.nodes,
        links: charts.links,
        itemStyle: {
          normal: {
            label: {
              show: true,
              formatter: function (item) {
                return item.data.name
              }
            }
          }
        }
      }]
    };
    // 用于告警的动态效果
    setInterval(() => {
      var dataI = []
      for (var n = 0; n < nodes.length; n++) {
        var alarm = nodes[n].alarm
        if (alarm !== null && alarm !== '' && alarm !== undefined) {
          option.series[0].data[n].symbolSize = 60
          option.series[0].data[n].label = {
            normal: {
              color: 'red'
            }
          }
          option.series[0].itemStyle.normal.label.formatter = function (item) {
            if (item.data.alarm !== undefined) {
              return item.data.name + '\n[ ' + item.data.alarm + ' ]'
            } else {
              return item.data.name
            }
          }
          dataI.push(n)
        }
      }
      myChart.setOption(option)
      setTimeout(() => {
        for (var m = 0; m < dataI.length; m++) {
          option.series[0].data[dataI[m]].symbolSize = 50
          option.series[0].data[dataI[m]].label = {
            normal: {
              color: '#000'
            }
          }
          option.series[0].itemStyle.normal.label.formatter = function (item) {
            return item.data.name
          }
        }
        myChart.setOption(option)
      }, 500)
    }, 1000)

    myChart.on('click', function (object) {
      console.log(object)
    });
  </script>
</body>

</html>